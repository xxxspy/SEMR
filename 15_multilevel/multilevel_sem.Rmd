---
title: "Multilevel SEM 多水平结构方程"
subtitle: "介绍结构方程和R语言应用"
author: "www.mlln.cn"
date: "2024-3-11"
output:
  html_document:
    code_folding: hide
    df_print: kable
    mathjax: default
    number_sections: yes
    theme: spacelab
    toc: yes
    fig_width: 9 
    fig_height: 6 
  pdf_document:
    code_folding: hide
    df_print: kable
    number_sections: yes
    toc: yes
    toc_depth: 4
---
<style type="text/css">
body{ font-size: 20px; max-width: 1600px; margin: auto; padding: 1em; }
code.r{ font-size: 18px; }
p { padding-top: 10px; padding-bottom: 10px; }
pre { font-size: 16px; }
</style>


注意我们的教程和代码以 `Rmd` 格式的文件存储， 这种文件是R代码常用格式， 我们的教程需要预先安装 Mplus . 

你可以使用Mplus的免费版: https://www.statmodel.com/demo.shtml

免费版有很多限制：

1.  Maximum number of dependent variables: 6
2.  Maximum number of independent variables: 2
3.  Maximum number of between variables in two-level analysis: 2
4.  Maximum number of continuous latent variables in time series analysis: 2

1.因变量最大数量：6
2.自变量最大数量：2
3.二水平分析中变量间最大数量：2
4.时间序列分析中连续潜变量的最大数量：2

现在“lavaan”的作者 Yves Rosseel 已经更新了 lavaan 这个R的代码包， 它已经可以做多水平的结构方程模型了， 但是因为本教程撰写之初，
lavaan 并没有完全支持多水平分析， 所以本教程并不是使用lavaan做结构方程， 而是在底层使用了mplus， 但是是在R的语言环境下使用的. 

本篇教程先介绍多水平结构方程的基本概念, 有一些数学符号可能难以理解, 
但是不要担心, 本教程不是给专家看的, 所以我们针对入门学生的一些常见问题进行讲解,
即便无法理解理论部分, 只要你遵循我们的指导也可以完成一篇合格的多水平结构方程的分析报告.

本篇教程主要使用mplus软件, Mplus 可能是好用的多水平结构方程软件，尽管 EQS 和 LISREL 中也有类似的功能.  
此外，R 中的 OpenMx 包是免费的，支持多级分析，但需要采用截然不同的语法和规范方法, 适合会R语言的童鞋.

这篇教程虽然使用了mplus, 但是我们建议你使用 R 的一个工具库 MplusAutomation, 这个工具库帮助你完成非常无聊的结果整理工作, 
因为 Mplus 输出的结果是文本文件, 难以转换为表格, 难以对比不同模型的结果, 所以我们鼓励你使用 MplusAutomation 这个工具, 
它可以自动帮你完成这个功能. 如果对R比较陌生， 可以看我们录制的R语言的快速入门视频教程, 因为学习编程的诀窍只有一个, 
就是快速入门, 快速应用, 视频放在这里[《R语言快速入门教程》](https://www.bilibili.com/video/BV1Wt4y1g7rn/)

```{r setup, include=FALSE}
if (!require(pacman)) { install.packages("pacman"); library(pacman) }
p_load(knitr, MASS, tidyverse, lavaan, modelr, semPlot, semTools, DiagrammeR, MplusAutomation, texreg, lme4)
knitr::opts_chunk$set(echo = TRUE) #print code by default
options(digits=3)
set.seed(15092) #to make simulated data the same across computers

#small function to plot all SEM diagrams using
semPaths_default <- function(lavObject, sizeMan=15, ...) {
  require(semPlot)
  semPaths(lavObject, nCharNodes = 0, sizeMan=sizeMan, sizeMan2=4, sizeLat = 13, sizeLat2=7, ...)
}

#Where the mplus binary lives on my computer. Only needed if installed in a non-standard location.
mbin <- "/Users/mnh5174/Applications/Mplus/mplus"
```

# 什么是多水平模型(不限于多水平结构方程模型)

从一般的线性模型开始, 然后逐渐引入多水平的概念. 你可以看下一般的线性回归模型:

$$
\begin{align*}
Y &= B_0 + B_1 X_1 + B_2 X_2 + ... B_p X_p + \varepsilon \\
\varepsilon &\sim \mathcal{N}(0, \sigma^2)
\end{align*}
$$

一般的线性模型理解起来非常简单, p个预测变量x, 通过线性组合, 来对被预测的变量Y进行预测. 但是这个模型有一个前提, 就是样本之间没有相互依赖, 
或者说, 回归残差ε是独立同分布的. 但是如果你的样本是重复测量的, 你可能会得到下面这样的样本数据:

重复测量的数据格式通常包括两种主要类型：长型格式和宽型格式. 

- 长型格式：在这种格式中，每个受试者的每次重复测量都会作为一条独立的记录. 例如，如果一个受试者被重复测量了四次，那么该受试者就会有四条记录. 每条记录都包含受试者的标识信息以及对应的测量值. 这种格式的优点在于可以清晰地展示每次测量的具体情况，但可能会导致数据集的行数较多. 
- 宽型格式：这是数据分析时最常用的格式. 在这种格式中，每个受试者只有一条记录，而重复测量的数据则作为该记录的不同变量. 例如，如果一个受试者被重复测量了四次，那么这四个测量值就会作为该受试者的四个不同变量. 这种格式的优点在于可以简化数据集的结构，方便进行统计分析，但可能需要对数据进行适当的转换和重构. 

如果是长型格式 , 你看下面的数据, 同一个被试会在不同的时间点测量4次, 那么同一个被试的4个样本是高度相关的, 这时候不可以直接使用一般线性回归分析.

| 被试ID | 测量轮次 | 测量值 |  
| :--: | :--: | :--: |  
| 001 | 1 | 25.5 |  
| 001 | 2 | 26.2 |  
| 001 | 3 | 25.8 |  
| 001 | 4 | 26.1 |  
| 002 | 1 | 24.9 |  
| 002 | 2 | 25.3 |  
| 002 | 3 | 25.1 |  
| 002 | 4 | 25.5 |  
| ... | ... | ... |

常见的多水平数据还有下面几种:

- 嵌套在个体中的实验任务的试验（例如，反应时间或准确性数据） 
- 在每只动物中测量一组神经元（例如，群体），但目的是描述一组动物的模式 
- 问卷或调查的纵向测量 
- 基于访谈的数据 
- 同一个班级的学生
- 治疗组内的患者

在每种情况下，多水平分析（包括多水平 SEM）的目标是明确解释组内和组间的变异性.  如果我们要分析数据而忽略群体结构，我们就会高估自由度（因为我们的观察是非独立的,没有那么自由）.  我们无法区分组内和组间的影响； 相反，我们的参数将反映两种效应的混合, 这使得我们得出错误的结论.

## 水平间效应

多水平分析还允许研究人员在模型的每个水平提出具体问题.  
让我们考虑一下学生 (L1层面) 嵌套在学校 (L2层面) 内的情况. 
 在学校层面，我们假设学生与教师的比例会影响阅读成绩，因此每位教师的学生越多，成绩越差.  
 根据定义，学生与教师的比例仅作为学校层面的变量才有意义（因为同一所学校的学生有类似的师生比例, 
 这个变量不随学校内学生的变化而变化），在个人层面上没有变化.  这可能看起来像下面这样的数据:

```{r}
tt <- dplyr::tribble(
~student, ~school, ~stratio, ~readtest,
1, "Radio Park", 20, 15,
2, "Radio Park", 20, 12,
3, "Radio Park", 20, 19,
4, "Corl Street", 16, 24,
5, "Corl Street", 16, 27,
6, "Corl Street", 16, 21
)

kable(tt)
```

- 第一列 student 是学生的编号. 
- 第二列 school 是学生所在的学校名称. 
- 第三列 stratio 是学生所在学校的师生比，即每个老师负责的学生数量. 从数据中可以看到，Radio Park 学校的师生比是20，而 Corl Street 学校的师生比是16. 
- 第四列 readtest 是学生的阅读测试分数. 


请注意，stratio在同一个学校下没有变化.  这是预测变量最简单的情况，因为不用担心它可能代表学生和学校效应的混合.  也就是说，stratio 无法预测任何 L1 方差(即同一个学校内学生阅读成绩的变化不可能是师生比决定的). 

用方程来表示变量的关系就是:

$$
\begin{align*}
\textrm{readtest}_{ij} &= \beta_{0j} + r_{ij} \\
\beta_{0j} &= \gamma_{00} + \gamma_{01} \textrm{stratio}_j + \mu_{0j} \\
\end{align*}
$$

第一个方程没有预测变量(自变量), j是学校代码, 
i是学生代码, 那么 $\beta_{0j}$ 意思是学校的阅读成绩平均分, 同一个学校的学生有同一个值, 
$r_{ij}$是学生的离均差, 即偏离所在学校的平均值 $\beta_{0j}$ 的大小. 
第二个方程 $\gamma_{00}$ 是所有学校所有同学的总平均分, 师生比会影响到学校的平均成绩， 师生比的效应是 $\gamma_{01}$ .  这个模型没有纳入任何个体层面的变量， 但是这个模型是帮助你理解什么是多水平模型的：
师生比通过影响学校平均水平$beta_{0j}$ 进而影响到了学生的成绩${readtest}_{ij}$.  
$\beta_{0j}$ 带有角标j, 说明它是一个变量, 但是它是未知的, 被称作随机截距. 

所以我们通常还会写一个整体模型:

$$
\begin{align*}
\textrm{readtest}_{ij} &= \gamma_{00} + \gamma_{01} \textrm{stratio}_j + \mu_{0j} + r_{ij}
\end{align*}
$$

我们只是把第二个等式替换到第一个等式中的 $\beta_{0j}$. 
你注意看小角标 i 和 j, 例如 $stratio_j$ 只有角标j, 说明在个体间同一个学校内是不变的. 


下面我们继续丰富我们的模型, 纳入个体层面的变量$readpermin$, 它用于测量学生的阅读速度, 案例数据如下:



```{r}
tt <- tt %>% add_column(readpermin=c(20, 14, 18, 25, 35, 30), .before="school")
kable(tt)
```

## Disaggregating within- versus between-cluster effects

## 区分组间和组内效应

下面的模型可以将阅读速度纳入:

$$
\begin{align*}
\textrm{readtest}_{ij} &= \beta_{0j} + \beta_{1} \textrm{readspeed}_{ij} + r_{ij} \\
\beta_{0j} &= \gamma_{00} + \gamma_{01} \textrm{stratio}_j + \mu_{0j}
\end{align*}
$$

$\beta_{1}$是阅读速度的系数, 它没有角标, 意味着它是一个固定效应, 它在所有个体和所有学校之间都是不变的.


重要的是, 个体层面的预测变量与结果变量(被预测变量)之间的关联可以反映个体之间的差异, 也可以反应学校的差异. 
也许学生的阅读速度更快是因为个人层面因素(某种气质类型),  或者一些学校可能有促进更好阅读的政策，因此平均阅读速度因学校而异）.
所以上面的模型并不能反映真实的情况. 那么我们可以让固定效应$\beta_{1}$变成随机效应, 模型这样写:


$$
\begin{align*}
\textrm{readtest}_{ij} &= \beta_{0j} + \beta_{1j} \textrm{readspeed}_{ij} + r_{ij} \\
\beta_{0j} &= \gamma_{00} + \gamma_{01} \textrm{stratio}_j + \mu_{0j} \\
\beta_{1j} &= \gamma_{10} + \mu_{1j}
\end{align*}
$$

$\beta_{1j}$是未知的, 因为有角标j, 代表随学校的不同而不同, 但在同一个学校内的个体间变化. 

由于阅读速度是一个 L1 变量（即个人/学生），
因此它可能在个人 (L1) 和学校 (L2) 层面上都有系统性的变化。 
在传统的多级建模 (MLM) 中，可以使用适当的中心化方法来分离每一级的变异（Curran & Bauer，2011）。 
例如，通常的方法是将预测变量（阅读速度）减去学校平均值(注意每个学校有不同的平均值奥)，
这样我们现在就有一个变量来表示阅读速度相对于学校平均值的变化, 这个新的变量放入L1层的模型就可以排除学校层面变异的影响。 
然后，我们还以学校均值(这是一个变量,因为每个学校有不同的平均阅读苏速度)并将其作为 L2 的预测变量。
这样，就可以具体考察每所学校的阅读速度对考试成绩的影响。 
同样，也可以检查学校平均水平无法解释的阅读速度的个体差异。

我们使用这种方法将阅读速度进行中心化:

$$
\dot{\textrm{readspeed}_{ij}} = \textrm{readspeed}_{ij} - \bar{\textrm{readspeed}_{j}}
$$

$\bar{\textrm{readspeed}_{j}}$是每个学校的阅读速度均值, 它随学校的不同而不同, 所以它是L2层面的变量; 
$\dot{\textrm{readspeed}_{ij}}$以学校均值为中心的阅读速度, 它反映了个体阅读速度的差异, 所以它是L1层面的变量.
这两个变量可以整合到模型中:

$$
\begin{align*}
\textrm{readtest}_{ij} &= \beta_{0j} + \beta_{1j} \dot{\textrm{readspeed}_{ij}} + r_{ij} \\
\beta_{0j} &= \gamma_{00} + \gamma_{01} \textrm{stratio}_j + \gamma_{02} \bar{\textrm{readspeed}_{j}} + \mu_{0j} \\
\beta_{1j} &= \gamma_{10} + \mu_{1j}
\end{align*}
$$

$\gamma_{02}$是L2层面的阅读速度的固定效应, 反映了学校整体阅读速度的变化对学生整体阅读成绩的影响;
$\beta_{1j}$是L1层面的阅读速度的随机效应, 也就是不同学校学生的阅读速度对阅读成绩的效应是不同的, 
不过你也可以假定为固定效应, 那就是不同学校有相同的效应, 写为 $\beta_{1}$.

$$
\textrm{readtest}_{ij} = ( \gamma_{00} + \gamma_{01} \textrm{stratio}_j +
\gamma_{02} \bar{\textrm{readspeed}_{j}} +
\gamma_{10} \dot{\textrm{readspeed}_{ij}} ) + \\
( r_{ij} + \mu_{0j} + \mu_{1j} \dot{\textrm{readspeed}_{ij}} )
$$

现在, 阅读速度实际上分解为两个变量, 一个体现校内变异, 一个体现校间变异.

# 多水平结构方程(MSEM)

好的，我们已经了解了标准的多层模型。 SEM 在哪里发挥作用？ 在多水平的 SEM 中，
我们使用潜在变量方法来分割校间和校内的变化，而不是普通的中心化变量的方法。 看下图：

![](multilevelsem_variance.png)

在这个图中, 组间变量即L2层的变量(同一个组内不存在个体间变异), 这些变量(例如$A_j$)不带有角标i, 意味着不存在校内的个体间变异.
在结构方程中, 潜变量是不可以被观测的变量, 用圆形或椭圆形表示, 所以你可以发现, 可观测的变量都位于中间位置, 
也就是说所有观测变量受到两个潜变量的影响, 一个是L1层的反应个体变异的潜变量, 一个是L2层的反应组间变异的潜变量.

重要的是, 这种模型是允许设置随机斜率和随机截距的, 前面已经论述过, 随机斜率和随机截距都是"潜变量", 即没有被观测的变量.
例如, 我们的模型可以回答这样的问题: 学校的师生比是否影响到L1层的学生阅读速度和阅读成绩之间的关系? 下面是模型图:


![](school_msem.png)

然而，多水平的SEM 比普通的 MLM 有什么优势?
为什么要选择使用多水平的 SEM？ 

- 首先，有些人发现在我们习惯于 SEM 的概念图, 容易概念化多级数据结构和模型。 
- 其次，与其他回归分析类似，多水平SEM 可以一次检验多个变量关系, 而不像普通回归那样一次只能有一个被预测变量。 有关 SEM 在测试多层次中介方面的价值的精彩介绍，请参阅 Preacher、Zyphur 和 Zhang (2010) 的《心理学方法》。
- 第三，多水平 SEM 使我们能够检验涉及潜在变量的假设，而这些假设在标准的多水平线性模型 中很难实现。 
- 第四，普通的多水平模型中, 均值中心化方法在组间方差中引入了潜在的偏差。 特别是，1 级观测值很少且组内相关性较低，会使组间效应的估计产生偏差（Lüdtke 等人，2008 年）。 这在跨级中介中尤其成问题，其中必须将方差的 L1 部分视为潜在变量以恢复无偏参数（Asparouhov & Muthén，2006）。 简而言之，MSEM 中的潜在分解往往比 MLM 中的中心方法提供更好的估计。


# 多水平 SEM 模型设置

多水平的SEM模型如下 (Muthén & Asparouhov, 2008) :

$$
\boldsymbol{Y}_{ij} = \boldsymbol{\nu_j} + \boldsymbol{\Lambda}_j\boldsymbol{\eta}_{ij} + \boldsymbol{K_j}\boldsymbol{X}_{ij} + \boldsymbol{\varepsilon}_{ij}
$$

As in non-multilevel SEM, $\boldsymbol{\nu}_j$ captures the intercepts of the variables, '
but allowing these to vary by cluster. And as usual, we have factor loadings ($\boldsymbol{\Lambda}_j$), 
factor scores (\boldsymbol{\eta}_{ij}), and the influence of exogenous covariates $\boldsymbol{X}_{ij}$. The important point is that all of these can potentially vary by cluster. I'll spare you the details on how MSEM parcels the structural and measurement models at the within and between levels... But the MSEM can be estimated using maximum likelihood in the typical fashion, with variance being assigned to the appropriate level by latent variable estimation.

$\boldsymbol{\nu}_j$是截距, 在普通的SEM中它是常量, 但是在多水平的MSEM中, 它可以在组间变化, 它现在是变量. 
因子载荷($\boldsymbol{\Lambda}_j$), 因子分($\boldsymbol{\eta}_{ij}$), 外生变量的协方差 $\boldsymbol{X}_{ij}$ 都是可以在组间变化的, 而普通的SEM是不同的.


# MSEM 在 Mplus中的设定

与 lavaan（遵循大多数 R 语法的 R 包）不同，Mplus 是一个具有自己语法的独立程序。 
尽管 Mplus 在数据管理和可视化方面无法与 R 的通用功能竞争，但 Mplus 开发了许多用于操作数据的有用功能，
例如变量的中心化和计算交互项。

Mplus的文件有三种：数据、模型语法和模型输出。
按照惯例，原始数据作为制表符分隔的文件提供，没有列标题，通常使用扩展名 .dat。 
Mplus模型语法有自己的约定，例如使用“ON”表示“Y ON X”的回归。同样，“WITH”表示“X AND Y”的无向（剩余）关联。
因子使用“BY”指定，如：“F1 BY X1 X2 X3”。 
Mplus 语法还包含定义模型的主要部分，例如估计器、哪些数据是分类的、要提供哪些输出等等。

按照惯例，Mplus 代码文件存储为扩展名为 .inp 的文本。 
Mplus提供的输出也是文本，存储为.out。输出文件中包含大量令人印象深刻的信息，但其以文本形式存储使得筛选每个部分非常耗时。
“MplusAutomation”中的“readModels()”命令可以通过将信息存储在 R 的数据结构（例如列表和 data.frames）中, 
这样你就可以方便的获得想要的数据. 

## WITHIN

如果一个变量在“VARIABLE”部分中被指定为“WITHIN”，则假定它*仅*在组内变化，并且在组之间没有变化。
因此，当 1) 变量在组内级别变化，以及 2) 我们希望在组内分配其方差的总体时，使用此语句，假设组之间不存在差异。

## BETWEEN

如果一个变量在“VARIABLE”部分中被指定为“BETWEEN”，则它是一个组间变量，在组内没有变化。这些通常称为 L2/L3 变量。
例如，如果我们研究嵌套在学校中的学生，学生与教师的比例将是“BETWEEN”变量。

## 不是 WITHIN 也不是 BETWEEN

如果我们没有指定变量是“WITHIN”或“BETWEEN”，那么 Mplus 将在两个级别对其方差进行建模。
也就是说，它将使用潜在分解将方差分为组内方差和组间方差。在组间级别，这意味着我们正在对该变量的随机截距进行建模。

# MSEM在mplus中的应用

让我们从一个简单的多级模型开始，我们可以使用传统的多水平建模软件来拟合该模型。这是 Mplus 用户指南中的示例 9.1。

## 中心化和变量分解

![](ex9.1a_diagram.png)

$y$ 框中的点表示 y 的随机截距。也就是说，$y$ 的平均水平存在组间变化，可以在水平之间进行建模。 
$x$ 是组内中心化后的变量, 在L1层变化。 $xm$ 是对 $x$ 的组内的平均值, 在L2层变化。 $w$ 是组级协变量（即，没有组内方差）。

```
TITLE:	this is an example of a two-level 
	regression analysis for a continuous 
	dependent variable with a random intercept and an observed covariate
DATA:	FILE = ex9.1a.dat;
VARIABLE:	NAMES = y x w xm clus;
	WITHIN = x;
	BETWEEN = w xm;
	CLUSTER = clus;
DEFINE:	CENTER x (GRANDMEAN);
ANALYSIS:	TYPE = TWOLEVEL;
MODEL:
	%WITHIN%	
	y ON x;
	%BETWEEN%
	y ON w xm;
```

下面我们逐行解读以上代码.

### TITLE

```
TITLE:	this is an example of a two-level 
	regression analysis for a continuous 
	dependent variable with a random intercept and an observed covariate
```

TITLE 命令用于提供标题, 就是为了方便人类阅读, 并无其他用途.

### DATA

```
DATA: FILE = ex9.1a.dat;
```

DATA 命令用于提供数据集的信息。 
FILE 选项用于指定包含要分析的数据的文件的名称，ex9.1a.dat.  
由于数据集默认为自由格式，因此不需要 FORMAT 语句。

### VARIABLE

```
VARIABLE:	NAMES = y x w xm clus;
	WITHIN = x;
	BETWEEN = w xm;
	CLUSTER = clus;
```

VARIABLE 命令用于提供有关数据集中变量的信息。 
NAMES 选项用于为数据集中的变量分配名称。 
此示例中的数据集包含五个变量：y、x、w、xm 和 clus。

WITHIN 选项用于标识数据集中在个体级别上测量并仅在组内级别上建模的变量。 
它们被指定为在模型的组间没有差异。 BETWEEN 选项用于识别数据集中的变量，这些变量是在组间(L2)上测量的，
并且仅在组间使用。 在WITHIN 或BETWEEN 语句中未提及的变量是在个体级别上测量的，并且可以在组内和组间建模。 
由于WITHIN 语句中未提及y，因此它是在既可以在组间也可以在组内使用。 
在组间只用时，它是随机截距。 
CLUSTER 选项用于标识分组变量。 
CENTER 选项用于指定分析中使用的居中类型以及要居中的变量。 在此示例中，选择了均值居中.

### DEFINE

```
DEFINE: CENTER x (GRANDMEAN);
```

DEFINE命令用于转换现有变量和创建新变量。 
CENTER 选项用于指定分析中使用的中心化类型以及将中心化的变量。 中心化有助于结果的解释。 
在此示例中，变量x使用总均值中心化，即从变量 x 的值中减去 x 的所有样本均值.

### ANALYSIS 

```
ANALYSIS: TYPE = TWOLEVEL;
```

ANALYSIS 命令用于描述分析的技术细节。 通过选择 TWOLEVEL，将估计具有随机截距的多级模型。
所以, 与其他多水平建模软件不同的是, 我们似乎没有明显的告诉mplus我们有一个随机的截距, 
但是指定了 TYPE = TWOLEVEL .

### MODEL

```
MODEL:
  %WITHIN%
  y ON x;
  %BETWEEN%
  y ON w xm;
```

MODEL命令用于描述要估计的模型。 
在多水平模型中，我们需要指定是组间还是组内。 在模型的组内部分"%WITHIN%"，ON 语句描述了 y 对个体水平协变量 x 的线性回归。 

在组间部分, ON 语句描述了y的随机截距对组间变量 w 和 xm 上的回归。 
ANALYSIS 命令的ESTIMATOR 选项可用于选择不同的估计器。 下面演示的是如何在R语言环境中, 使用mplus: 


```{r}
ex9.1a <- read.table("ex9.1a.dat", col.names = c("y", "x", "w", "xm", "clus"))
kable(head(ex9.1a, n=15))

ex9.1a_mobj <- mplusObject(
  TITLE="this is an example of a two-level 
	  regression analysis for a continuous 
	  dependent variable with a random intercept and an observed covariate",
  VARIABLE="WITHIN = x;
	  BETWEEN = w xm;
	  CLUSTER = clus;",
  DEFINE = "CENTER x (GRANDMEAN);",
  ANALYSIS = "TYPE = TWOLEVEL;
    ESTIMATOR=MLR;",
  MODEL = "%WITHIN%	
	  y ON x;
	  %BETWEEN%
	  y ON w xm;",
  OUTPUT="STDYX RESIDUAL;",
  rdata = ex9.1a
)

ex9.1a_fit <- mplusModeler(ex9.1a_mobj, modelout = "ex9.1a.inp", run=TRUE, Mplus_command = mbin, hashfilename = FALSE)
screenreg(ex9.1a_fit$results, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"))

#examine w/i and b/w data structure
#ex9.1a <- ex9.1a %>% group_by(clus) %>% mutate(xm_mine=mean(x), xwi=x - xm_mine)
#round(cor(ex9.1), 3)
```

我们用`R` 中的 `lmer` 函数来构建同样的模型:

```{r}
ex9.1a_lmer <- lmer(y ~ x + w + xm + (1 | clus), ex9.1a, REML=FALSE)
summary(ex9.1a_lmer)
```

你可以看到, 结果一样.

## 潜变量分解法

与多层线性模型（MLM）不同，多层结构方程模型（MSEM）还可以将观测变量分解为两个潜变量, 一个是组内的, 一个是组间的。让我们重新运行这个分析，使用潜变量分解法。


![](ex9.1b_diagram.png)

```
TITLE:	this is an example of a two-level 
	regression analysis for a continuous 
	dependent variable with a random intercept and a latent covariate
DATA:	FILE = ex9.1b.dat;
VARIABLE:	NAMES = y x w clus;
	BETWEEN = w;
	CLUSTER = clus;
DEFINE: CENTER x (GRANDMEAN);
ANALYSIS:	TYPE = TWOLEVEL;
MODEL:
	%WITHIN%	
	y ON x (gamma10);
	%BETWEEN%
	y ON w 
	x (gamma01);
MODEL CONSTRAINT:
	NEW(betac);
	betac = gamma01 - gamma10;
```

以上代码与之前的代码区别是，变量 x 被分解为两个潜在变量部分，而不是像传统多水平回归建模中那样被视为观察变量。 
当 VARIABLE 语句中未将 x 设定为组内和组间时,  x 会在组内和组之间建模时，就会发生分解。 
分解的数学表达式是:

$$
x_{ij} = x_{wij} + x_{bj}
$$

式中 i 表示个体, j 表示组, $x_{bj}$代表了只在组间变动的变量, 它其实是x的分组均值, 
$x_{wij}$代表了只在组内变动的变量, 相当于$x_{ij}-groupmean$, 所以分解也可以写成:

$$
x_{wij} = x_{ij} - x_{bj}
$$


在 MODEL 命令中，模型WITHIN部分的标签 gamma10 和模型BETWEEN部分的标签 gamma01 被分配给模型两个部分中 y 对 x 的线性回归中的回归系数，
以用于后面的调用. "MODEL CONSTRAINT" 用于设定模型的约束. "NEW"用于创建一个新参数. 这个参数叫做betac, 它指的是 gamma01 和 gamma10 之差.
我们之所以定义这个参数, 因为它被成为 “contextual effect” (Raudenbush and Bryk, 2002, p. 140, Table 5.11)


下面是代码运行的结果:

```{r}
ex9.1b <- read.table("ex9.1b.dat", col.names = c("y", "x", "w", "clus"))
kable(head(ex9.1b, n=15))

ex9.1b_mobj <- mplusObject(
  TITLE="this is an example of a two-level 
	  regression analysis for a continuous 
	  dependent variable with a random intercept and a latent covariate",
  VARIABLE="BETWEEN = w;
	  CLUSTER = clus;",
  DEFINE = "CENTER x (GRANDMEAN);",
  ANALYSIS = "TYPE = TWOLEVEL;
    ESTIMATOR=MLR;",
  MODEL = "
    %WITHIN%
	    y ON x (gamma10);
	  %BETWEEN%
	    y ON w 
	         x (gamma01);",
  MODELCONSTRAINT = "NEW(betac);
	betac = gamma01 - gamma10;",
  OUTPUT="STDYX RESIDUAL;",
  rdata = ex9.1b
)

ex9.1b_fit <- mplusModeler(ex9.1b_mobj, modelout = "ex9.1b.inp", run=TRUE, Mplus_command = mbin, hashfilename = FALSE)
summary(ex9.1b_fit)
 coef(ex9.1b_fit)
 ex9ex9.1b_fit$
screenreg(ex9.1b_fit$results, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"))
#ex9.1 <- ex9.1 %>% group_by(clus) %>% mutate(xm_mine=mean(x), xwi=x - xm_mine)
#ex9.1 %>% group_by(clus) %>% 

```

## Random slopes in MSEM

As in standard MLM, we might expect there to be between-person variation in the strength of an association. For example, are there meaningful interindividual differences in the rate of change in age-related declines in memory? In MSEM, we need to specify these random slopes as latent variables that vary at L2.

Here is example 9.2 from the users guide using the within-between latent disaggregation for $x$, an L1 predictor.

```
TITLE:	this is an example of a two-level 
	regression analysis for a continuous 
	dependent variable with a random slope and a latent covariate
DATA:   FILE = ex9.2c.dat;
VARIABLE:	NAMES = y x w clus;
	BETWEEN = w;
	CLUSTER = clus;
ANALYSIS:	TYPE = TWOLEVEL RANDOM;
MODEL:
	%WITHIN%	
 	s | y ON x;		
	%BETWEEN%	
	y s ON w x;
	y WITH s;
```

```{r}
ex9.2c <- read.table("ex9.2c.dat", col.names = c("y", "x", "w", "clus"))
kable(head(ex9.2c, n=15))

ex9.2c_mobj <- mplusObject(
  TITLE="this is an example of a two-level 
	regression analysis for a continuous 
	dependent variable with a random slope and a latent covariate",
  VARIABLE="BETWEEN = w;
	  CLUSTER = clus;",
  DEFINE = "CENTER x (GRANDMEAN);",
  ANALYSIS = "TYPE = TWOLEVEL RANDOM;
    ESTIMATOR=MLR;",
  MODEL = "
    %WITHIN%	
 	    s | y ON x;		
	  %BETWEEN%	
	    y s ON w x;
	    y WITH s;",
  OUTPUT="STDYX RESIDUAL;",
  rdata = ex9.2c
)

ex9.2c_fit <- mplusModeler(ex9.2c_mobj, modelout = "ex9.2c.inp", run=TRUE, Mplus_command = mbin, hashfilename = FALSE)
screenreg(ex9.2c_fit$results, single.row=TRUE, summaries = c("AICC"))

```


# Hox Family IQ MSEM example

These data are from Joop Hox's multilevel book. The basic structure is that we have six intelligence measures for 400 children from 60 families. Thus, we have children nested within families. If intelligence has a genetic or heritable component, the between-family differences may be of particular interest. The measures are word list, cards, matrices, figures, animals, and occupations.
One possibility is that the intelligence tests all form a single *g* factor at the between-family level such that some families have higher average scores on intelligence measures than others. Another possibility is that the subscales form two factor: numeric (word list, cards, matrices) versus perceptual (figures, animals, occupations) intelligence.

As in the case of standard MLM, in MSEM, we often wish to examine the amount of variation at each level in an unconditional model. For SEM purposes, examining the independence and saturated models is informative. As we've talked about in standard SEM, the independence model gives us a worst case fit where we do not permit item covariation. And the saturated model gives us perfect fit without any parsimony or prediction. This is true of MSEM as well, but we can examine the spectrum between independence and saturated at both the within and between levels.

## Independence model

To get a sense of whether there is structured variance in IQ due to family, we can estimate an independence model for the data in which the IQ variables are assumed to be unrelated at both the within- and between-family levels. This gives us a benchmark for variation at these levels.

Here is the raw Mplus syntax

```
TITLE:  Within independence; Between independence;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
 %BETWEEN%
OUTPUT: STDYX SAMPSTAT;
```

Note that I've printed out the unstandardized estimates here to give a sense of variation in each variable in the original unit. Otherwise, we'd see variances of 1.0 at both levels for the standardized estimates. For other models, however, I primarily report completely standardized effects (std.all in lavaan terms) for interpretability.

```{r}
#import data from spss
hoxdata <- haven::read_spss("FamIQData.sav")

mobj1 <- mplusObject(
  TITLE = "Within independence; Between independence;",
  VARIABLE = "CLUSTER = family;
    USEVARIABLES ARE wordlist cards matrices figures animals occupats;",
  ANALYSIS = "TYPE IS TWOLEVEL;
    ESTIMATOR IS MLR;",
  MODEL = "%WITHIN%
    %BETWEEN%",
  OUTPUT = "STDYX SAMPSTAT;",
  rdata=hoxdata
)
mfit1 <- mplusModeler(mobj1, modelout = "hox_m1.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)

screenreg(mfit1, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"))
```

## Saturated model

At the other end of the spectrum, we could estimate a saturated model for both within- and between-cluster variation.

Here is the raw Mplus syntax:

```
TITLE:  Within saturated, Between saturated;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
  wordlist cards matrices figures animals occupats WITH
  wordlist cards matrices figures animals occupats;
 %BETWEEN%
  wordlist cards matrices figures animals occupats WITH
  wordlist cards matrices figures animals occupats; 
OUTPUT: STDYX SAMPSTAT;
```

These are the standardized covariances, aka correlations.

```{r}
mobj2 <- update(
  mobj1, 
  TITLE = ~ "W/i saturated, B/w saturated;",
  MODEL = ~ "
    %WITHIN%
      wordlist cards matrices figures animals occupats WITH
        wordlist cards matrices figures animals occupats;
    %BETWEEN%
      wordlist cards matrices figures animals occupats WITH
        wordlist cards matrices figures animals occupats;")

mfit2 <- mplusModeler(mobj2, modelout = "hox_m2.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit2, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

## One-factor between-family, one-factor within-family

What about a simple/parsimonious model in which we assume a one-factor structure at the within and between levels?

![](hox_msem_onefac_both.png)

```
TITLE:  Within one factor; Between one factor;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
  gen_wi BY wordlist* cards matrices figures animals occupats;
  gen_wi@1;
 %BETWEEN%
  gen_bw BY wordlist* cards matrices figures animals occupats;
  gen_bw@1;
OUTPUT: STDYX SAMPSTAT;
```

Note the Heywood case here: there's a negative residual on the animals variable at the between level. One strategy would be to add `animals@0;` to the between syntax to fix the residual variance to 0, but the case is pretty bad in the sense that the negative variance is significant, not trivially below zero. Given how badly the model fits at the within-person level (see SRMR.Within), I would probably give up on this and move on to other models.

```{r}
mobj3 <- update(
  mobj1, 
  TITLE = ~ "W/i one factor; B/w one factor;",
  MODEL = ~ "
    %WITHIN%
      gen_wi BY wordlist* cards matrices figures animals occupats;
      gen_wi@1;
    %BETWEEN%
      gen_bw BY wordlist* cards matrices figures animals occupats;
      gen_bw@1;")

mfit3 <- mplusModeler(mobj3, modelout = "hox_m3.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit3, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```


## One-factor between-family, saturated within-family model

```
TITLE:  Within saturated--Between one factor; Table 14.7, p. 308;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
  wordlist cards matrices figures animals occupats WITH
  wordlist cards matrices figures animals occupats;
 %BETWEEN%
  general BY wordlist* cards matrices figures animals occupats;
  general@1;
OUTPUT: STDYX SAMPSTAT;
```

```{r}
mobj4 <- update(
  mobj1, 
  TITLE = ~ "W/i saturated; B/w one factor;", # Table 14.7, p. 308
  MODEL = ~ "%WITHIN%
  wordlist cards matrices figures animals occupats WITH
  wordlist cards matrices figures animals occupats;
 %BETWEEN%
  general BY wordlist* cards matrices figures animals occupats;
  general@1;")

mfit4 <- mplusModeler(mobj4, modelout = "hox_m4.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit4, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

## Within two-factor, Between saturated

```
TITLE: Within two factor--Between saturated;
 Table 14.1, p. 301 & Table 14.7, p. 308;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
  numeric BY wordlist* cards matrices;
  percept BY figures* animals occupats;
  numeric@1 percept@1;
 %BETWEEN%
  wordlist cards matrices figures animals occupats WITH
  wordlist cards matrices figures animals occupats; 
OUTPUT: STDYX SAMPSTAT;
```

```{r}
mobj5 <- update(
  mobj1, 
  TITLE = ~ "Within two factor--Between saturated;", # Table 14.1, p. 301 & Table 14.7, p. 308
  MODEL = ~ "%WITHIN%
    numeric BY wordlist* cards matrices;
    percept BY figures* animals occupats;
    numeric@1 percept@1;
   %BETWEEN%
    wordlist cards matrices figures animals occupats WITH
    wordlist cards matrices figures animals occupats;")

mfit5 <- mplusModeler(mobj5, modelout = "hox_m5.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit5, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

Detailed comparison of within two-factor model against saturated model, including nested chi-square test.
```{r}
compareModels(mfit2$results, mfit5$results, diffTest = TRUE)
```

## Within two-factor, between one-factor

![](hox_msem_onefacbw_twofacwi.png)

```
TITLE: Within two factor; Between one factor;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
  numeric BY wordlist* cards matrices;
  percept BY figures* animals occupats;
  numeric@1 percept@1;
 %BETWEEN%
  general BY wordlist* cards matrices figures animals occupats;
  general@1;
OUTPUT: STDYX SAMPSTAT;
```

```{r}
mobj6 <- update(
  mobj1, 
  TITLE = ~ "W/i two factor; B/w one factor;",
  MODEL = ~ " %WITHIN%
    numeric BY wordlist* cards matrices;
    percept BY figures* animals occupats;
    numeric@1 percept@1;
   %BETWEEN%
    general BY wordlist* cards matrices figures animals occupats;
    general@1;")

mfit6 <- mplusModeler(mobj6, modelout = "hox_m6.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit6, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

## Within saturated, between independence

```
TITLE: Within saturated; Between independence; Table 14.7, p. 308;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
  wordlist cards matrices figures animals occupats WITH
  wordlist cards matrices figures animals occupats;
 %BETWEEN%
OUTPUT: STDYX SAMPSTAT;
```

```{r}
mobj7 <- update(
  mobj1, 
  TITLE = ~ "W/i saturated; B/w independence;", # Table 14.7, p. 308
  MODEL = ~ "
    %WITHIN%
      wordlist cards matrices figures animals occupats WITH
        wordlist cards matrices figures animals occupats;
    %BETWEEN%")

mfit7 <- mplusModeler(mobj7, modelout = "hox_m7.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit7, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

## Within independence, between saturated

```
TITLE: Within independence--Between saturated; Table 14.7, p. 308;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
 %BETWEEN%
  wordlist cards matrices figures animals occupats WITH
  wordlist cards matrices figures animals occupats; 
OUTPUT: STDYX SAMPSTAT;
```

```{r}
mobj8 <- update(
  mobj1, 
  TITLE = ~ "W/i independence; B/w saturated;", # Table 14.7, p. 308
  MODEL = ~ "
    %WITHIN%
    %BETWEEN%
      wordlist cards matrices figures animals occupats WITH
        wordlist cards matrices figures animals occupats;")

mfit8 <- mplusModeler(mobj8, modelout = "hox_m8.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit8, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

## Within independence, between one-factor

```
TITLE: Within independence--Between one factor
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
 %BETWEEN%
  general BY wordlist* cards matrices figures animals occupats;
  general@1;
OUTPUT: STDYX SAMPSTAT;
```

```{r}
mobj9 <- update(
  mobj1, 
  TITLE = ~ "Within independence; Between one factor",
  MODEL = ~ "
    %WITHIN%
    %BETWEEN%
      general BY wordlist* cards matrices figures animals occupats;
      general@1;")

mfit9 <- mplusModeler(mobj9, modelout = "hox_m9.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit9, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

## Within two-factor, between independence

```
TITLE: Within two factor--Between independence; Table 14.1, p. 301;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
  numeric BY wordlist* cards matrices;
  percept BY figures* animals occupats;
  numeric@1 percept@1;
 %BETWEEN%
OUTPUT: STDYX SAMPSTAT;
```

```{r}
mobj10 <- update(
  mobj1, 
  TITLE = ~ "W/i two factor; B/w independence;", # Table 14.1, p. 301
  MODEL = ~ "
    %WITHIN%
      numeric BY wordlist* cards matrices;
      percept BY figures* animals occupats;
      numeric@1 percept@1;
    %BETWEEN%")

mfit10 <- mplusModeler(mobj10, modelout = "hox_m10.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit10, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

## Within two-factor, between null

```
TITLE: Within two factor--Between null; Table 14.1, p. 301;
DATA: FILE IS "FamIQData.dat";
VARIABLE: NAMES ARE
 family child wordlist cards matrices figures animals occupats;
USEVARIABLES ARE wordlist cards matrices figures animals occupats;
CLUSTER IS family;
ANALYSIS: TYPE IS TWOLEVEL;
 ESTIMATOR IS MLR;
MODEL:
 %WITHIN%
  numeric BY wordlist* cards matrices;
  percept BY figures* animals occupats;
  numeric-percept@1;
 %BETWEEN%
 wordlist@0 cards@0 matrices@0 figures@0 animals@0 occupats@0; 
OUTPUT: STDYX SAMPSTAT;
```

```{r}
mobj11a <- update(
  mobj1, 
  TITLE = ~ "Within two factor; Between null;", #Table 14.1, p. 301
  MODEL = ~ "
    %WITHIN%
      numeric BY wordlist* cards matrices;
      percept BY figures* animals occupats;
      numeric@1 percept@1;
    %BETWEEN%
      wordlist@0 cards@0 matrices@0 figures@0 animals@0 occupats@0;")

mfit11a <- mplusModeler(mobj11a, modelout = "hox_m11a.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit11a, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

Different assumption in which we force variance to be at level 1 only, rather than
allowing for it to be at L1 and L2, but constraining L2 to zero.
```{r}
mobj11b <- update(
  mobj1, 
  TITLE = ~ "Within two factor--Between null; Table 14.1, p. 301;",
  VARIABLE = ~ . + "WITHIN ARE wordlist cards matrices figures animals occupats;",
  MODEL = ~ "
    %WITHIN%
      numeric BY wordlist* cards matrices;
      percept BY figures* animals occupats;
      numeric@1 percept@1;
    %BETWEEN%")

mfit11b <- mplusModeler(mobj11b, modelout = "hox_m11b.inp", run=1L, Mplus_command = mbin, hashfilename = FALSE)
screenreg(mfit11b, single.row=TRUE, summaries = c("AICC", "CFI", "SRMR.Within", "SRMR.Between"), type="stdyx")
```

## Model selection

```{r}
SummaryTable(list(mfit1, mfit2, mfit3, mfit4, mfit5, mfit6, mfit7, mfit8, mfit9, mfit10, mfit11a), 
            keepCols = c("Title", "LL", "Parameters", "AICC", 
                         "BIC", "RMSEA_Estimate", "CFI", "SRMR.Within", "SRMR.Between"),
                         sortBy = "AICC")
```